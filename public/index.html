<!DOCTYPE html>
<html>
  <head>
    <title>Uniregistry</title>
    
    <link rel="stylesheet" href="../dependencies/bootstrap.min.css" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <script src="../dependencies/react.js"></script>
    <script src="../dependencies/JSXTransformer.js"></script>
    <script src="../dependencies/jquery.min.js"></script>
    <script src="../dependencies/underscore-min.js"></script>
    <!-- Firebase -->
    <script src="https://cdn.firebase.com/js/client/2.0.1/firebase.js"></script>

    <!-- ReactFire -->
    <script src="https://cdn.firebase.com/libs/reactfire/0.4.0/reactfire.min.js"></script>    <script src="scripts.js"></script>
    <link rel="stylesheet" href="base.css" />
  </head>
  <body>
 



    <div id="container">
        
    </div>
    


    <script type="text/jsx">
      
      var data = new Firebase("https://uniregistry.firebaseio.com/");  

      var DomainTable = React.createClass({
        render: function() {
          var RowList = _.map(this.props.data.domains, function (domainObject) {
            return (
              <Row domain={domainObject.domain} price={domainObject.price} email={domainObject.registrant_email}> 
              </Row>
            );
          });
          return (
            <div className="domainTable col-sm-offset-2 col-sm-8">
          
              <table className="table table-striped-react">
                <tr>
                  <th className="domain-column">Domain name</th>
                  <th className="check-column">Uniregistry</th> 
                  <th className="price-column">Price</th>
                </tr>
                {RowList}
              </table>
            </div>
          );
        }
      });

      var Row = React.createClass({
        editModal: function() {
          React.render(
            <DomainDetail email={this.props.email} domain={this.props.domain} price={this.props.price} />,
            document.getElementById('container')
          );
        },
        render: function() {
        function endsWith(string, suffix) {
          return string.indexOf(suffix, string.length - suffix.length) !== -1;
        }
        var check = ""
        if (endsWith(this.props.domain, ".lol") || endsWith(this.props.domain, ".cars")){
          check = <i className="fa fa-check"></i>
        }
          return (
            <tr>
              <td className="table-domain" onClick={this.editModal}> {this.props.domain}</td>
              <td className="table-check"> {check} </td>
              <td className="table-price"> ${(this.props.price/100).toFixed(2)}</td>
            </tr>
          );
        }
      });

      var DomainDetail = React.createClass({
    
        getInitialState: function() {
          return {domain: this.props.domain, email: this.props.email, price: (this.props.price/100).toFixed(2)};
        },
        handleChange: function(event) {
          var data = {}
          data[event.target.name] = event.target.value
          this.setState(data);

        },

        render: function () {

          return(
            <div className="domainForm col-sm-offset-2 col-sm-8">
              <form className="form-horizontal">

                <div className="form-group">
                  <label for="domain-form" className="col-xs-3 control-label">Domain name</label>
                  <div className="col-xs-9">
                    <input type="text" className="form-control" id="domain-form" name="domain" value={this.state.domain} onChange={this.handleChange}/>
                  </div>
                </div>
                <div className="form-group">
                  <label for="email-form" className="col-xs-3 control-label">Registran Email</label>
                  <div className="col-xs-9">
                    <input type="text" className="form-control" id="email-form" name="email" value={this.state.email} onChange={this.handleChange}/>
                  </div>
                </div>
                <div className="form-group">
                  <label for="price-form" className="col-xs-3 control-label">Price</label>
                  <div className="col-xs-9">
                    <input type="text" className="form-control" id="price-form" name="price" value={this.state.price} onChange={this.handleChange}/>
                  </div>
                </div>
                <div className="form-group">
                  <div className="col-xs-offset-3 col-xs-9">
                    <button type="submit" className="btn btn-default save-button">Save changes</button>
                  </div>
                </div>

               
              </form>
            </div>
          )
        }
 
      })

      data.on("value", function(snapshot) {
        data = snapshot.val();
        React.render(
          <DomainTable data={data} />,
          document.getElementById('container')
        );
      });

    





    </script>

  </body>  

</html>
